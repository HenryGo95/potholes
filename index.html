<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Detección de Baches - YOLOv8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .file-input-label {
            border: 2px dashed #ccc;
            transition: all 0.3s;
        }
        .file-input-label:hover {
            border-color: #4f46e5;
            background-color: #f8fafc;
        }
        .file-input-label.drag-over {
            border-color: #4f46e5;
            background-color: #e0e7ff;
        }
        .result-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .pothole-small {
            border-color: #10b981;
        }
        .pothole-medium {
            border-color: #f59e0b;
        }
        .pothole-large {
            border-color: #ef4444;
        }
        .progress-bar {
            height: 6px;
            transition: width 0.3s;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #imagePreviewContainer img {
            max-height: 300px;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-10 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-800 mb-2">
                <i class="fas fa-road mr-2"></i>Sistema de Detección de Baches
            </h1>
            <p class="text-lg text-gray-600">Utilizando visión por computadora con YOLOv8 para el análisis de pavimentos</p>
            <div class="w-full bg-indigo-100 h-1 mt-4 rounded-full"></div>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Form and Upload -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-md p-6 h-fit sticky top-4">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-upload mr-2 text-indigo-600"></i> Cargar Datos
                </h2>

                <!-- Tabs -->
                <div class="mb-6">
                    <div class="flex border-b border-gray-200">
                        <button class="tab-btn py-2 px-4 font-medium text-indigo-600 border-b-2 border-indigo-600" data-tab="images">
                            <i class="fas fa-image mr-1"></i> Imágenes
                        </button>
                        <button class="tab-btn py-2 px-4 font-medium text-gray-500 hover:text-indigo-600" data-tab="video">
                            <i class="fas fa-video mr-1"></i> Video
                        </button>
                    </div>
                </div>

                <!-- Images Tab Content -->
                <div id="images-tab" class="tab-content active">
                    <div id="fileInputLabel" class="file-input-label rounded-lg p-6 text-center cursor-pointer mb-4">
                        <i class="fas fa-cloud-upload-alt text-4xl text-indigo-500 mb-3"></i>
                        <p class="text-gray-600 mb-1">Arrastra y suelta imágenes aquí</p>
                        <p class="text-sm text-gray-500">o haz clic para seleccionar archivos</p>
                        <input type="file" id="fileInput" class="hidden" accept="image/*" multiple>
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <p>Formatos soportados: JPG, PNG, WEBP</p>
                        <p>Máximo 10 imágenes simultáneas</p>
                    </div>
                </div>

                <!-- Video Tab Content -->
                <div id="video-tab" class="tab-content">
                    <div class="file-input-label rounded-lg p-6 text-center cursor-pointer mb-4">
                        <i class="fas fa-video text-4xl text-indigo-500 mb-3"></i>
                        <p class="text-gray-600 mb-1">Arrastra y suelta video aquí</p>
                        <p class="text-sm text-gray-500">o haz clic para seleccionar archivo</p>
                        <input type="file" id="videoInput" class="hidden" accept="video/*">
                    </div>
                    <div class="text-sm text-gray-500 mb-4">
                        <p>Formatos soportados: MP4, MOV, AVI</p>
                        <p>Duración máxima: 5 minutos</p>
                    </div>
                </div>

                <!-- Preview of selected files -->
                <div id="filePreview" class="mb-4 hidden">
                    <h3 class="font-medium text-gray-700 mb-2">Archivos seleccionados:</h3>
                    <div id="selectedFilesList" class="text-sm text-gray-600 space-y-1"></div>
                </div>

                <!-- Progress Bar -->
                <div id="uploadProgressContainer" class="mb-6 hidden">
                    <div class="flex justify-between text-sm text-gray-600 mb-1">
                        <span>Progreso de carga</span>
                        <span id="progressPercentage">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full">
                        <div id="uploadProgressBar" class="progress-bar bg-indigo-600 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Technical Data Form -->
                <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-4 flex items-center">
                    <i class="fas fa-clipboard-list mr-2 text-indigo-600"></i> Datos Técnicos
                </h2>
                <form id="technicalForm" class="space-y-4">
                    <div>
                        <label for="pavementType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de pavimento</label>
                        <select id="pavementType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Seleccionar...</option>
                            <option value="asfalto">Asfalto</option>
                            <option value="concreto">Concreto</option>
                            <option value="adoquin">Adoquín</option>
                            <option value="empedrado">Empedrado</option>
                        </select>
                    </div>
                    <div>
                        <label for="roadType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de carretera</label>
                        <select id="roadType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Seleccionar...</option>
                            <option value="federal">Federal</option>
                            <option value="estatal">Estatal</option>
                            <option value="municipal">Municipal</option>
                            <option value="privada">Privada</option>
                        </select>
                    </div>
                    <div>
                        <label for="regulation" class="block text-sm font-medium text-gray-700 mb-1">Normativa aplicable</label>
                        <select id="regulation" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="">Seleccionar...</option>
                            <option value="sct">SCT - Secretaría de Comunicaciones y Transportes</option>
                            <option value="astm">ASTM International</option>
                            <option value="aashto">AASHTO</option>
                            <option value="local">Normativa local</option>
                        </select>
                    </div>
                    <div>
                        <label for="roadSection" class="block text-sm font-medium text-gray-700 mb-1">Nombre/ID del tramo</label>
                        <input type="text" id="roadSection" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </form>

                <!-- Process Button -->
                <button id="processBtn" class="w-full mt-6 py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-md shadow-md transition duration-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-play-circle mr-2"></i> Procesar Archivos
                </button>
            </div>

            <!-- Right Column - Results -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Detection Results Section -->
                <div id="resultsSection" class="hidden bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-search mr-2 text-indigo-600"></i> Resultados de Detección
                        </h2>
                        <button id="generatePdfBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md flex items-center">
                            <i class="fas fa-file-pdf mr-2"></i> Generar PDF
                        </button>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-indigo-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-indigo-700 font-medium">Total de baches</p>
                            <p id="totalPotholes" class="text-2xl font-bold text-indigo-800">0</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-green-700 font-medium">Pequeños</p>
                            <p id="smallPotholes" class="text-2xl font-bold text-green-800">0</p>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-yellow-700 font-medium">Medianos</p>
                            <p id="mediumPotholes" class="text-2xl font-bold text-yellow-800">0</p>
                        </div>
                        <div class="bg-red-50 rounded-lg p-4 text-center">
                            <p class="text-sm text-red-700 font-medium">Grandes</p>
                            <p id="largePotholes" class="text-2xl font-bold text-red-800">0</p>
                        </div>
                    </div>

                    <!-- Processed Images -->
                    <div id="processedImages" class="space-y-6">
                        <!-- Images will be added here dynamically -->
                    </div>
                </div>

                <!-- Materials Calculation Section -->
                <div id="materialsSection" class="hidden bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <i class="fas fa-calculator mr-2 text-indigo-600"></i> Cálculo de Materiales
                    </h2>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <!-- Volume Calculation -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium text-gray-700 mb-3">Volumen estimado por tipo</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-green-700">Pequeños (5cm prof.)</span>
                                    <span id="smallVolume" class="font-medium">0 m³</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-yellow-700">Medianos (8cm prof.)</span>
                                    <span id="mediumVolume" class="font-medium">0 m³</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-red-700">Grandes (12cm prof.)</span>
                                    <span id="largeVolume" class="font-medium">0 m³</span>
                                </div>
                                <div class="border-t border-gray-200 my-2"></div>
                                <div class="flex justify-between text-sm font-medium">
                                    <span>Volumen total</span>
                                    <span id="totalVolume">0 m³</span>
                                </div>
                            </div>
                        </div>

                        <!-- Material Requirements -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-medium text-gray-700 mb-3">Requerimientos estimados</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span>Mezcla asfáltica</span>
                                    <span id="asphaltMix" class="font-medium">0 ton</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Mano de obra</span>
                                    <span id="labor" class="font-medium">0 hrs</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span>Maquinaria</span>
                                    <span id="machinery" class="font-medium">0 hrs</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cost Calculation -->
                    <div class="bg-indigo-50 rounded-lg p-4 mb-6">
                        <h3 class="font-medium text-indigo-700 mb-3">Cálculo de costos</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Precio por tonelada de mezcla ($)</label>
                                <input type="number" id="asphaltPrice" value="1500" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Costo por hora de mano de obra ($)</label>
                                <input type="number" id="laborPrice" value="250" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Costo por hora de maquinaria ($)</label>
                                <input type="number" id="machineryPrice" value="800" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div class="border-t border-indigo-200 my-2"></div>
                            <div class="flex justify-between font-medium text-indigo-800">
                                <span>Costo total estimado</span>
                                <span id="totalCost">$0</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-sm text-gray-500">
                        <p><i class="fas fa-info-circle mr-1 text-indigo-500"></i> Los cálculos se basan en estimaciones estándar y pueden variar según condiciones específicas.</p>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="bg-white rounded-xl shadow-md p-12 text-center">
                    <i class="fas fa-road text-5xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-medium text-gray-500 mb-2">No hay datos para mostrar</h3>
                    <p class="text-gray-400 mb-6">Carga imágenes o video y completa el formulario para comenzar el análisis.</p>
                    <button id="sampleDataBtn" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md text-sm font-medium">
                        <i class="fas fa-magic mr-1"></i> Usar datos de ejemplo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab-btn').forEach(t => {
                    t.classList.remove('border-indigo-600', 'text-indigo-600');
                    t.classList.add('text-gray-500');
                });
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // Add active class to clicked tab and corresponding content
                btn.classList.remove('text-gray-500');
                btn.classList.add('border-indigo-600', 'text-indigo-600');
                document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
            });
        });

        // File upload functionality
        const fileInputLabel = document.getElementById('fileInputLabel');
        const fileInput = document.getElementById('fileInput');
        const videoInput = document.getElementById('videoInput');
        const selectedFilesList = document.getElementById('selectedFilesList');
        const filePreview = document.getElementById('filePreview');
        const uploadProgressContainer = document.getElementById('uploadProgressContainer');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const progressPercentage = document.getElementById('progressPercentage');
        const processBtn = document.getElementById('processBtn');
        const emptyState = document.getElementById('emptyState');
        const resultsSection = document.getElementById('resultsSection');
        const materialsSection = document.getElementById('materialsSection');
        const sampleDataBtn = document.getElementById('sampleDataBtn');
        const generatePdfBtn = document.getElementById('generatePdfBtn');

        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            fileInputLabel.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            fileInputLabel.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            fileInputLabel.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            fileInputLabel.classList.add('drag-over');
        }

        function unhighlight() {
            fileInputLabel.classList.remove('drag-over');
        }

        fileInputLabel.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({target: {files}});
        }

        function handleFiles(e) {
            const files = e.target.files;
            if (files.length > 0) {
                displaySelectedFiles(files);
                simulateUpload();
            }
        }

        function displaySelectedFiles(files) {
            selectedFilesList.innerHTML = '';
            const fileList = document.createElement('div');

            for (let i = 0; i < Math.min(files.length, 10); i++) {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center py-1';

                const icon = document.createElement('i');
                icon.className = files[i].type.startsWith('image/') ? 'fas fa-image mr-2 text-indigo-500' : 'fas fa-file mr-2 text-gray-500';

                const fileName = document.createElement('span');
                fileName.textContent = files[i].name;
                fileName.className = 'truncate flex-1';

                fileItem.appendChild(icon);
                fileItem.appendChild(fileName);
                fileList.appendChild(fileItem);
            }

            selectedFilesList.appendChild(fileList);
            filePreview.classList.remove('hidden');

            // Enable process button if form is complete
            checkFormCompletion();
        }

        function simulateUpload() {
            uploadProgressContainer.classList.remove('hidden');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                uploadProgressBar.style.width = `${progress}%`;
                progressPercentage.textContent = `${Math.round(progress)}%`;
            }, 200);
        }

        // Form validation
        const formInputs = document.querySelectorAll('#technicalForm input, #technicalForm select');
        formInputs.forEach(input => {
            input.addEventListener('change', checkFormCompletion);
        });

        function checkFormCompletion() {
            let formComplete = true;
            formInputs.forEach(input => {
                if (!input.value) formComplete = false;
            });

            // Also need files to be selected
            const filesSelected = document.querySelectorAll('#selectedFilesList div').length > 0;

            processBtn.disabled = !(formComplete && filesSelected);
        }

        // Process button click
        processBtn.addEventListener('click', () => {
            processBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Procesando...';
            processBtn.disabled = true;

            // Simulate processing delay
            setTimeout(() => {
                showResults();
                processBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Proceso completado';
                processBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                processBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            }, 3000);
        });

        // Show results with sample data
        function showResults() {
            emptyState.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            materialsSection.classList.remove('hidden');

            // Update summary cards
            document.getElementById('totalPotholes').textContent = '23';
            document.getElementById('smallPotholes').textContent = '11';
            document.getElementById('mediumPotholes').textContent = '8';
            document.getElementById('largePotholes').textContent = '4';

            // Add sample processed images
            const processedImages = document.getElementById('processedImages');
            processedImages.innerHTML = '';

            // Add 3 sample images with detections
            for (let i = 1; i <= 3; i++) {
                const imageCard = document.createElement('div');
                imageCard.className = 'result-card bg-white border border-gray-200 rounded-lg overflow-hidden';

                const imageHeader = document.createElement('div');
                imageHeader.className = 'bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center';

                const imageTitle = document.createElement('h3');
                imageTitle.className = 'font-medium text-gray-700';
                imageTitle.textContent = `Imagen ${i}`;

                const imageCount = document.createElement('span');
                imageCount.className = 'bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded';
                imageCount.textContent = i === 1 ? '5 baches' : i === 2 ? '9 baches' : '9 baches';

                imageHeader.appendChild(imageTitle);
                imageHeader.appendChild(imageCount);

                const imageContainer = document.createElement('div');
                imageContainer.className = 'p-4 flex justify-center';

                const img = document.createElement('img');
                img.src = `https://source.unsplash.com/random/600x300/?road,damage&${i}`;
                img.alt = `Processed image ${i}`;
                img.className = 'rounded-md max-h-64';

                // Add bounding boxes (simulated detections)
                if (i === 1) {
                    img.style.position = 'relative';

                    // Add bounding boxes
                    addBoundingBox(img, 50, 100, 80, 60, 'small');
                    addBoundingBox(img, 200, 80, 100, 70, 'medium');
                    addBoundingBox(img, 350, 120, 120, 90, 'large');
                    addBoundingBox(img, 150, 200, 70, 50, 'small');
                    addBoundingBox(img, 400, 180, 90, 65, 'medium');
                } else if (i === 2) {
                    img.style.position = 'relative';

                    // Add bounding boxes
                    addBoundingBox(img, 30, 50, 60, 40, 'small');
                    addBoundingBox(img, 120, 70, 70, 50, 'small');
                    addBoundingBox(img, 220, 100, 110, 80, 'medium');
                    addBoundingBox(img, 350, 60, 130, 100, 'large');
                    addBoundingBox(img, 100, 180, 80, 60, 'small');
                    addBoundingBox(img, 200, 200, 90, 70, 'medium');
                    addBoundingBox(img, 300, 150, 100, 80, 'medium');
                    addBoundingBox(img, 450, 200, 70, 50, 'small');
                    addBoundingBox(img, 500, 100, 120, 90, 'large');
                } else {
                    img.style.position = 'relative';

                    // Add bounding boxes
                    addBoundingBox(img, 50, 80, 70, 50, 'small');
                    addBoundingBox(img, 150, 100, 90, 70, 'medium');
                    addBoundingBox(img, 280, 70, 120, 90, 'large');
                    addBoundingBox(img, 420, 120, 80, 60, 'small');
                    addBoundingBox(img, 100, 200, 100, 80, 'medium');
                    addBoundingBox(img, 250, 180, 70, 50, 'small');
                    addBoundingBox(img, 350, 200, 110, 90, 'medium');
                    addBoundingBox(img, 450, 150, 130, 100, 'large');
                    addBoundingBox(img, 500, 80, 60, 40, 'small');
                }

                imageContainer.appendChild(img);
                imageCard.appendChild(imageHeader);
                imageCard.appendChild(imageContainer);
                processedImages.appendChild(imageCard);
            }

            // Update materials calculation
            updateMaterialsCalculation();
        }

        function addBoundingBox(img, x, y, width, height, size) {
            const box = document.createElement('div');
            box.style.position = 'absolute';
            box.style.left = `${x}px`;
            box.style.top = `${y}px`;
            box.style.width = `${width}px`;
            box.style.height = `${height}px`;
            box.style.border = '2px solid';

            if (size === 'small') {
                box.classList.add('pothole-small');
            } else if (size === 'medium') {
                box.classList.add('pothole-medium');
            } else {
                box.classList.add('pothole-large');
            }

            img.parentNode.insertBefore(box, img.nextSibling);
        }

        // Sample data button
        sampleDataBtn.addEventListener('click', () => {
            // Fill form with sample data
            document.getElementById('pavementType').value = 'asfalto';
            document.getElementById('roadType').value = 'federal';
            document.getElementById('regulation').value = 'sct';
            document.getElementById('roadSection').value = 'Tramo 5 - Carretera Federal 150';

            // Simulate file selection
            const files = [
                {name: 'carretera_1.jpg', type: 'image/jpeg'},
                {name: 'carretera_2.jpg', type: 'image/jpeg'},
                {name: 'carretera_3.jpg', type: 'image/jpeg'}
            ];

            displaySelectedFiles(files);
            simulateUpload();
            checkFormCompletion();
        });

        // Materials calculation
        function updateMaterialsCalculation() {
            // Get values from the form
            const smallCount = 11;
            const mediumCount = 8;
            const largeCount = 4;

            // Calculate volumes (area * depth)
            // Assuming average area for each size
            const smallVolume = (smallCount * 0.3 * 0.3 * 0.05).toFixed(2); // 30x30cm, 5cm deep
            const mediumVolume = (mediumCount * 0.5 * 0.5 * 0.08).toFixed(2); // 50x50cm, 8cm deep
            const largeVolume = (largeCount * 0.8 * 0.8 * 0.12).toFixed(2); // 80x80cm, 12cm deep
            const totalVolume = (parseFloat(smallVolume) + parseFloat(mediumVolume) + parseFloat(largeVolume)).toFixed(2);

            // Update volume display
            document.getElementById('smallVolume').textContent = `${smallVolume} m³`;
            document.getElementById('mediumVolume').textContent = `${mediumVolume} m³`;
            document.getElementById('largeVolume').textContent = `${largeVolume} m³`;
            document.getElementById('totalVolume').textContent = `${totalVolume} m³`;

            // Calculate material requirements
            const asphaltMix = (totalVolume * 2.4).toFixed(1); // 2.4 ton/m³ density
            const laborHours = (smallCount * 0.5 + mediumCount * 1 + largeCount * 1.5).toFixed(1);
            const machineryHours = (smallCount * 0.2 + mediumCount * 0.5 + largeCount * 1).toFixed(1);

            document.getElementById('asphaltMix').textContent = `${asphaltMix} ton`;
            document.getElementById('labor').textContent = `${laborHours} hrs`;
            document.getElementById('machinery').textContent = `${machineryHours} hrs`;

            // Update cost calculation
            calculateCosts();
        }

        // Cost calculation
        function calculateCosts() {
            const asphaltPrice = parseFloat(document.getElementById('asphaltPrice').value) || 0;
            const laborPrice = parseFloat(document.getElementById('laborPrice').value) || 0;
            const machineryPrice = parseFloat(document.getElementById('machineryPrice').value) || 0;

            const asphaltMix = parseFloat(document.getElementById('asphaltMix').textContent) || 0;
            const laborHours = parseFloat(document.getElementById('labor').textContent) || 0;
            const machineryHours = parseFloat(document.getElementById('machinery').textContent) || 0;

            const totalCost = (asphaltMix * asphaltPrice + laborHours * laborPrice + machineryHours * machineryPrice).toFixed(2);

            document.getElementById('totalCost').textContent = `$${totalCost}`;
        }

        // Event listeners for price inputs
        document.getElementById('asphaltPrice').addEventListener('input', calculateCosts);
        document.getElementById('laborPrice').addEventListener('input', calculateCosts);
        document.getElementById('machineryPrice').addEventListener('input', calculateCosts);

        // Generate PDF
        generatePdfBtn.addEventListener('click', async () => {
            generatePdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generando PDF...';

            // Simulate PDF generation
            setTimeout(() => {
                generatePdfBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> PDF generado';
                alert('PDF generado con éxito. En una implementación real, se descargaría el documento.');

                // Reset button after 3 seconds
                setTimeout(() => {
                    generatePdfBtn.innerHTML = '<i class="fas fa-file-pdf mr-2"></i> Generar PDF';
                }, 3000);
            }, 2000);
        });

        // In a real implementation, you would use jsPDF and html2canvas to generate the PDF
        // Here's a placeholder for that functionality:
        /*
        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();

            // Add title
            pdf.setFontSize(20);
            pdf.text('Reporte de Detección de Baches', 105, 20, { align: 'center' });

            // Add technical data
            pdf.setFontSize(12);
            pdf.text(`Tipo de pavimento: ${document.getElementById('pavementType').value}`, 20, 40);
            pdf.text(`Tipo de carretera: ${document.getElementById('roadType').value}`, 20, 50);
            pdf.text(`Normativa: ${document.getElementById('regulation').value}`, 20, 60);
            pdf.text(`Tramo carretero: ${document.getElementById('roadSection').value}`, 20, 70);

            // Add summary
            pdf.text(`Total de baches: ${document.getElementById('totalPotholes').textContent}`, 20, 90);
            pdf.text(`Pequeños: ${document.getElementById('smallPotholes').textContent}`, 20, 100);
            pdf.text(`Medianos: ${document.getElementById('mediumPotholes').textContent}`, 20, 110);
            pdf.text(`Grandes: ${document.getElementById('largePotholes').textContent}`, 20, 120);

            // Add processed images (would need to capture them with html2canvas)
            // This is a simplified example - in reality you'd loop through images

            // Add materials calculation
            pdf.text(`Volumen total: ${document.getElementById('totalVolume').textContent}`, 20, 180);
            pdf.text(`Mezcla asfáltica: ${document.getElementById('asphaltMix').textContent}`, 20, 190);
            pdf.text(`Costo total estimado: ${document.getElementById('totalCost').textContent}`, 20, 200);

            // Save the PD
            pdf.save('reporte_baches.pdf');
        }
        */
    </script>
</body>
</html>
